設計選擇說明：

本設計採用先進的多代理 RAG (Retrieval-Augmented Generation) 架構，旨在為零售連鎖店提供自動化、基於數據且具備深度洞察的報告與儀表板生成能力。系統的設計核心在於確保數據的準確性、洞察的可靠性及流程的高效性。

**1. 數據攝取與嵌入 (Data Ingestion & Embedding)：**
   - **實踐細節**：原始數據（如退貨與保固記錄）首先會經過嚴格的清洗與預處理，去除雜訊並標準化格式。隨後，數據會被切分為大小適中、語義連貫的「塊」(chunks)，並提取相關元數據（如時間戳、產品ID、地區等）。這些文本塊透過預訓練的**嵌入模型**（例如：Google 的 Universal Sentence Encoder 或 OpenAI 的 text-embedding-ada-002）轉換為高維向量。選擇這些模型是基於其在多領域文本理解上的卓越性能和生成高質量語義嵌入的能力，確保後續檢索的精準度。
   - **技術考量**：分塊策略會平衡上下文完整性與檢索效率；元數據的提取則為後續的過濾和精確檢索提供關鍵依據。

**2. 向量資料庫 (Vector Database)：**
   - **實踐細節**：生成的向量嵌入會被儲存在專為高效相似性搜索設計的**向量資料庫**中（例如：Pinecone, ChromaDB 或 Weaviate）。這些資料庫利用先進的索引技術（如 HNSW - Hierarchical Navigable Small Worlds）來優化近似最近鄰 (ANN) 搜索，即使面對海量數據也能實現毫秒級的檢索響應。同時，元數據的儲存允許在檢索時進行精確過濾，例如按時間範圍或產品類別檢索。
   - **技術考量**：選擇這些雲原生或易於部署的向量資料庫，是為了確保系統的可擴展性、低延遲和高可用性，以應對零售數據的快速增長和實時查詢需求。

**3. 查詢處理與檢索 (Query Processing & Retrieval)：**
   - **實踐細節**：用戶的自然語言查詢（例如：「上季度高退貨率產品的根本原因」）會使用與數據攝取階段**相同的嵌入模型**轉換為查詢向量，以確保向量空間的一致性。隨後，這個查詢向量會在向量資料庫中執行**相似性搜索**（通常採用餘弦相似度），檢索出與查詢語義最相關的 Top-K 個數據塊。為進一步提升相關性，可選地引入**重排序模型**（如基於 Cross-Encoder 的模型），對初步檢索結果進行二次評分和排序。
   - **技術考量**：保持嵌入模型一致性是確保檢索精度的關鍵；相似性搜索算法的選擇則平衡了檢索速度與準確性；重排序機制則能有效過濾掉語義相關但內容不精確的數據塊。

**4. LLM 整合與響應生成 (LLM Integration & Response Generation)：**
   - **實踐細節**：檢索到的相關數據塊、用戶原始查詢以及一個精心設計的**系統提示 (System Prompt)** 會被一同送入大型語言模型（LLM，例如：Gemini 系列模型）。系統提示會明確指示 LLM 的角色、輸出格式、以及如何利用提供的上下文生成洞察。LLM 會被引導進行**思維鏈 (Chain-of-Thought)** 推理，並從提供的數據塊中提取關鍵資訊，生成**帶有明確引用的敘述性洞察**。引用機制確保了洞察的可追溯性和事實性。
   - **技術考量**：提示工程是引導 LLM 行為的關鍵，確保其輸出符合預期；結合檢索到的上下文能顯著降低 LLM 的「幻覺」現象，提升洞察的可靠性；自動生成引用則增強了報告的透明度和可信度。

**5. 多代理協同與輸出生成 (Multi-Agent Orchestration & Output Generation)：**
   - **實踐細節**：`Report Agent` 作為核心協調者，負責管理整個流程，從接收用戶查詢、觸發 RAG 流程、到整合 LLM 生成的洞察。`Excel Agent` 和 `Dashboard Agent` 則專注於將這些洞察和相關數據轉化為結構化的 Excel 報告（包含表格、圖表）和互動式網頁儀表板（包含條形圖、折線圖及敘述性摘要）。
   - **技術考量**：代理間的模組化設計確保了系統的靈活性和可維護性，每個代理專注於特定任務，提高了整體效率和錯誤隔離能力。